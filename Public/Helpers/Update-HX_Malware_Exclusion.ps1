function Update-HX_Malware_Exclusion {
	<#
	.Synopsis
	   You get a pop-up to choose what policies to edit
	.DESCRIPTION
	   Long description
	.EXAMPLE
	   Update-HX_Malware_Exclusion -action add -type process -entry "C:\Program Files\NotMalware.exe"
	.EXAMPLE
	   Another example of how to use this cmdlet
	.INPUTS
	   Inputs to this cmdlet (if any)
	.OUTPUTS
	   Output from this cmdlet (if any)
	.NOTES
	   General notes
	.COMPONENT
	   The component this cmdlet belongs to
	.ROLE
	   The role this cmdlet belongs to
	.FUNCTIONALITY
	   The functionality that best describes this cmdlet
	#>
	
	[CmdletBinding()]
	Param
	(
		# what you want to do
		[Parameter(Mandatory=$true, 
					ValueFromPipeline=$false,
					Position=0
					)]
		[ValidateNotNull()]
		[ValidateNotNullOrEmpty()]
		[ValidateSet("add","remove")]
		[string]$action,

		# if its a process or path
		[Parameter(Mandatory=$true, 
					ValueFromPipeline=$false,
					Position=1
					)]
		[ValidateNotNull()]
		[ValidateNotNullOrEmpty()]
		[ValidateSet("process","path","MD5")]
		[string]$type,

		# What you want to exclude
		[Parameter(Mandatory=$true, 
					ValueFromPipeline=$true,
					ValueFromPipelineByPropertyName=$true, 
					ValueFromRemainingArguments=$false, 
					Position=2
					)]
		[string]$entry,
		[switch]$Proxy
	)


	Write-Host -ForegroundColor Cyan "[Update-HX_Malware_Exclusion]::Getting Policies"

	if ($Proxy){
		$policies = (Invoke-HX_API -API Policies -action list -limit 100 -Proxy).data.entries
	}

	else {
		$policies = (Invoke-HX_API -API Policies -action list -limit 100).data.entries
	}

	Write-Host -ForegroundColor Cyan "[Update-HX_Malware_Exclusion]::Got Policies"	

	$picks = $policies|Out-GridView -PassThru

	foreach ($pick in $picks){

		if (!$pick.categories.malware_protection){
			Write-Host -ForegroundColor Magenta "[Update-HX_Malware_Exclusion]::Policy Named `"$($pick.name)`" Does not have Malware Protection category configured already, Skipping"
			break
		}

		Write-Host "[Update-HX_Malware_Exclusion]::Processing Policy Name: $($pick.name)"

		switch ($action){
			"add"{
				switch ($type){
					"process"{
						if ($entry -notin $pick.categories.malware_protection.excludedProcesses){
							$pick.categories.malware_protection.excludedProcesses = $pick.categories.malware_protection.excludedProcesses+$entry
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry already exists in $($pick.name)"
							break
						}
					}

					"path"{
						if ($entry -notin $pick.categories.malware_protection.excludedFiles){
							$pick.categories.malware_protection.excludedFiles = $pick.categories.malware_protection.excludedFiles+$entry
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry already exists in $($pick.name)"
							break
						}
					}
					"md5"{
						if ($entry -notin $pick.categories.malware_protection.excludedmd5s){
							$pick.categories.malware_protection.excludedmd5s = $pick.categories.malware_protection.excludedmd5s+$entry
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry already exists in $($pick.name)"
							break
						}
					}
				}
			}
			"remove"{
				switch ($type){

					"process"{
						if ($entry -in $pick.categories.malware_protection.excludedProcesses){
							$pick.categories.malware_protection.excludedProcesses = $pick.categories.malware_protection.excludedProcesses | Where-Object {$_ -ne $entry}
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry Did not exist in $($pick.name)"
							break
						}
					}
					"path"{
						if ($entry -in $pick.categories.malware_protection.excludedFiles){
							$pick.categories.malware_protection.excludedFiles = $pick.categories.malware_protection.excludedFiles | Where-Object {$_ -ne $entry}
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry Did not exist in $($pick.name)"
							break
						}
					}
					"md5"{
						if ($entry -in $pick.categories.malware_protection.excludedMD5s){
							$pick.categories.malware_protection.excludedMD5s = $pick.categories.malware_protection.excludedMD5s | Where-Object {$_ -ne $entry}
							$update=$true
						}
						else {
							Write-Host -ForegroundColor Yellow "[Update-HX_Malware_Exclusion]::$entry Did not exist in $($pick.name)"
							break
						}
					}
				}
			}
		}

		if ($update){
			if ($proxy){
				Invoke-HX_API -API Policies -action update -ID $pick._id -Policy $pick -Verbose -Proxy
			}
			else{
				Invoke-HX_API -API Policies -action update -ID $pick._id -Policy $pick -Verbose
			}
		}
		Clear-Variable update -ErrorAction SilentlyContinue
	}
}
